<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dollar Miner Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Tailwind CDN (development quick test only) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Í∏∞Îä•Î≥ÑÎ°ú Î∂ÑÎ¶¨Îêú CSS ÌååÏùºÎì§ -->
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/dashboard.css" rel="stylesheet">
    <link href="/static/css/strategy.css" rel="stylesheet">
    <link href="/static/css/order.css" rel="stylesheet">
    <style>
        [v-cloak] { display: none !important; }
        body { 
            background-color: #f8fafc !important; 
            color: #1e293b !important;
        }
        /* Î™®Î∞îÏùº ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
            border-top: 1px solid #e2e8f0;
            padding: 8px 0;
            padding-bottom: calc(8px + env(safe-area-inset-bottom, 0px));
            z-index: 9999;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
        }
        .mobile-nav-inner {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 400px;
            margin: 0 auto;
        }
        .mobile-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 16px;
            background: none;
            border: none;
            color: #64748b;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 8px;
        }
        .mobile-nav-btn:hover,
        .mobile-nav-btn.active {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.08);
        }
        .mobile-nav-btn i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }
        @media (max-width: 768px) {
            .mobile-nav {
                display: block !important;
            }
            body {
                padding-bottom: calc(70px + env(safe-area-inset-bottom, 0px)) !important;
            }
            /* Î™®Î∞îÏùºÏóêÏÑú ÏÇ¨Ïù¥ÎìúÎ∞î ÏôÑÏ†ÑÌûà Ïà®ÍπÄ */
            #sidebar {
                display: none !important;
            }
            /* Î™®Î∞îÏùºÏóêÏÑú Î©îÏù∏ Ïª®ÌÖêÏ∏† ÎßàÏßÑ Ï†úÍ±∞ */
            #mainContent {
                margin-left: 0 !important;
            }
            /* Î™®Î∞îÏùº YouTube Ìó§Îçî - Î≤ÑÌäº Ï§ÑÎ∞îÍøà */
            .youtube-header-wrapper .d-flex.justify-content-between {
                flex-direction: column;
                align-items: flex-start !important;
            }
            .youtube-action-btns {
                width: 100%;
                justify-content: flex-start;
                margin-top: 8px;
            }
            .youtube-action-btns .btn {
                padding: 6px 10px;
                font-size: 0.85rem;
            }
            .youtube-action-btns .btn .btn-text {
                display: none;
            }
            .youtube-action-btns .btn i {
                margin-right: 0 !important;
            }
        }
    </style>
    <script>
        // ÏÇ¨Ïù¥ÎìúÎ∞î ÌÜ†Í∏Ä Ìï®Ïàò - Ïù∏ÎùºÏù∏ onclickÏóêÏÑú ÏÇ¨Ïö©ÌïòÍ∏∞ ÏúÑÌï¥ Î®ºÏ†Ä Ï†ïÏùò
        let isSidebarOpen = true;
        function toggleSidebar() {
            isSidebarOpen = !isSidebarOpen;
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const brandIcon = document.getElementById('brandIcon');
            const brandText = document.getElementById('brandText');
            const sidebarContent = document.getElementById('sidebarContent');
            
            if (isSidebarOpen) {
                sidebar.style.width = '220px';
                mainContent.style.marginLeft = '220px';
                brandIcon.classList.remove('mx-auto');
                brandIcon.classList.add('mr-2');
                brandText.style.display = 'inline';
                sidebarContent.style.display = 'block';
            } else {
                sidebar.style.width = '64px';
                mainContent.style.marginLeft = '64px';
                brandIcon.classList.remove('mr-2');
                brandIcon.classList.add('mx-auto');
                brandText.style.display = 'none';
                sidebarContent.style.display = 'none';
            }
        }
    </script>
</head>

<body class="bg-slate-50">
    <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
    <aside id="sidebar" class="fixed left-0 top-0 h-full bg-slate-50 transition-all duration-300 z-50" style="width: 220px;">
        <div class="pt-6 px-3 pb-6 space-y-8 h-full overflow-y-auto">
            <!-- Î∏åÎûúÎìú / ÌÜ†Í∏Ä Î≤ÑÌäº -->
            <button id="sidebarToggle" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white transition-all" onclick="toggleSidebar()">
                <h1 class="font-bold flex items-center">
                    <i class="fas fa-dollar-sign text-blue-600 transition-all mr-2 text-2xl" id="brandIcon"></i>
                    <span id="brandText" class="bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent text-xl">Dollar Miner</span>
                </h1>
            </button>

            <!-- ÏûëÏóÖ ÏÑπÏÖò -->
            <div id="sidebarContent">
                <!-- ÌéòÏù¥ÏßÄ ÏÑπÏÖò -->
                <div class="space-y-2 mt-8">
                    <h3 class="text-xs font-semibold text-slate-700 uppercase tracking-wider px-3 mb-2">Pages</h3>
                    <div class="space-y-1">
                        <button onclick="showDashboard()" class="sidebar-nav-btn w-full px-3 py-2.5 text-slate-700 hover:bg-white rounded-lg text-xs font-medium transition-all flex items-center" data-view="dashboard">
                            <i class="fas fa-home mr-3 text-slate-500"></i>
                            <span>Dashboard</span>
                        </button>
                        <button onclick="showYoutubeSummary()" class="sidebar-nav-btn w-full px-3 py-2.5 text-slate-700 hover:bg-white rounded-lg text-xs font-medium transition-all flex items-center" data-view="youtube">
                            <i class="fab fa-youtube mr-3 text-slate-500"></i>
                            <span>Youtube Summary</span>
                        </button>
                    </div>
                </div>

                <!-- ÏãúÏä§ÌÖú ÏÑπÏÖò -->
                <div class="space-y-2 mt-8">
                    <h3 class="text-xs font-semibold text-slate-700 uppercase tracking-wider px-3 mb-2">System</h3>
                    <button onclick="showLogs()" class="sidebar-nav-btn w-full px-3 py-2.5 text-slate-700 hover:bg-white rounded-lg text-xs font-medium transition-all flex items-center" data-view="logs">
                        <i class="fas fa-file-alt mr-3 text-slate-500"></i>
                        <span>View Logs</span>
                    </button>
                </div>
            </div>
        </div>
    </aside>

    <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
    <div id="mainContent" class="transition-all duration-300" style="margin-left: 220px;">
        <div class="max-w-7xl mx-auto px-6 py-8">
            <!-- Header -->
            <div class="page-header d-flex justify-content-between align-items-center mb-6">
                <h1><i class="bi bi-graph-up-arrow me-2"></i>Dollar Miner</h1>
                <div class="d-flex gap-2 align-items-center">
                    <div id="fearGreedBadge" class="fear-greed-indicator"
                        style="height: 32px; padding: 0 14px; display: inline-flex; align-items: center; justify-content: center; border-radius: 6px; font-weight: 600; font-size: 0.85rem; line-height: 32px; box-shadow: 0 2px 6px rgba(0,0,0,0.12); transition: all 0.3s ease; background-color: #6c757d; color: #ffffff;">
                        <i class="bi bi-hourglass-split me-2"></i>Loading...
                    </div>
                </div>
            </div>

        <!-- VIEW: Dashboard -->
        <div id="dashboard-view" class="view-section active">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h4 class="mb-1 fw-bold">Dashboard</h4>
                    <p class="text-muted mb-0 small">Manage your trading strategies</p>
                </div>
                <button class="btn btn-primary" onclick="openCreateModal()">
                    <i class="bi bi-plus-lg me-2"></i>Create New Strategy
                </button>
            </div>

            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-collection me-2"></i>Active Strategies</span>
                    <button class="btn btn-sm btn-outline-secondary" onclick="loadStrategies()">
                        <i class="bi bi-arrow-clockwise"></i>
                    </button>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table align-middle mb-0">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th class="text-end">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="strategyListBody">
                                <!-- Loaded via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: Strategy Details -->
        <div id="strategy-details-view" class="view-section">
            <div class="strategy-header d-flex align-items-center gap-3">
                <button class="btn btn-outline-secondary" onclick="showDashboard()">
                    <i class="bi bi-arrow-left"></i>
                </button>
                <div class="flex-grow-1">
                    <h4 class="mb-1 fw-bold" id="detailStrategyName">Strategy Name</h4>
                    <div class="d-flex gap-2">
                        <span class="badge bg-info" id="detailStrategyType">Type</span>
                        <span class="badge bg-success" id="detailStrategyStatus">Active</span>
                    </div>
                </div>
                <div id="currentTickerPrice" class="text-end">
                    <span class="text-muted">Loading...</span>
                </div>
            </div>

            <div class="row">
                <!-- Left Col: Config & Actions -->
                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-gear me-2"></i>Configuration</span>
                            <div>
                                <button class="btn btn-sm btn-outline-secondary" id="editConfigBtn"
                                    onclick="editStrategyConfig()">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-success" id="saveConfigBtn" onclick="saveStrategyConfig()"
                                    style="display:none;">
                                    <i class="bi bi-check-lg"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" id="cancelConfigBtn"
                                    onclick="cancelStrategyConfig()" style="display:none;">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <pre id="detailConfig">Loading...</pre>
                            <textarea id="detailConfigEditor" class="form-control" rows="10"
                                style="display:none; font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem;"></textarea>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header"><i class="bi bi-lightning me-2"></i>Quick Actions</div>
                        <div class="card-body d-grid gap-2">
                            <button class="btn" onclick="runStrategy()" style="background-color: #e2e8f0; color: #475569; border: none; font-weight: 500;">
                                <i class="bi bi-play-fill me-2"></i>Run Daily Routine
                            </button>
                            <button class="btn" onclick="sendDailySummary()" style="background-color: #e2e8f0; color: #475569; border: none; font-weight: 500;">
                                <i class="bi bi-send me-2"></i>Send Daily Summary
                            </button>
                            <button id="deactivateStrategyBtn" class="btn" onclick="deactivateStrategy()" style="background-color: #e2e8f0; color: #475569; border: none; font-weight: 500;">
                                <i class="bi bi-pause-circle me-2"></i>Deactivate Strategy
                            </button>
                            <button id="activateStrategyBtn" class="btn" onclick="activateStrategy()" style="display:none; background-color: #e2e8f0; color: #475569; border: none; font-weight: 500;">
                                <i class="bi bi-play-circle me-2"></i>Activate Strategy
                            </button>
                            <button class="btn" onclick="deleteStrategy()" style="background-color: #e2e8f0; color: #475569; border: none; font-weight: 500;">
                                <i class="bi bi-trash me-2"></i>Delete Strategy
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Right Col: Snapshots -->
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-clock-history me-2"></i>Snapshot History</span>
                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-outline-secondary" onclick="loadSnapshots()">
                                    <i class="bi bi-arrow-clockwise"></i>
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="openCreateSnapshotModal()">
                                    <i class="bi bi-plus-lg"></i>
                                    Create Snapshot
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div id="snapshotTableContainer" class="table-responsive"
                                style="max-height: 600px; overflow-y: auto;">
                                <table class="table align-middle mb-0">
                                    <thead style="position: sticky; top: 0; background-color: white; z-index: 10;">
                                        <tr>
                                            <th>ID</th>
                                            <th>Date</th>
                                            <th>Cycle</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                        </tr>
                                    </thead>
                                    <tbody id="snapshotListBody">
                                        <!-- Loaded via JS -->
                                    </tbody>
                                </table>
                                <div id="snapshotLoadingIndicator"
                                    style="display: none; text-align: center; padding: 10px;">
                                    <div class="spinner-border spinner-border-sm" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: Logs -->
        <div id="logs-view" class="view-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <button class="btn btn-outline-secondary" onclick="showDashboard()">
                        <i class="bi bi-arrow-left"></i>
                    </button>
                    <span class="ms-3">
                        <h4 class="mb-1 fw-bold d-inline">System Logs</h4>
                        <p class="text-muted mb-0 small d-inline ms-2">View application logs</p>
                    </span>
                </div>
                <button class="btn btn-primary" onclick="loadLogs()">
                    <i class="bi bi-arrow-clockwise me-2"></i>Refresh
                </button>
            </div>
            <div class="row mb-3 align-items-stretch" style="min-height: 100px;">
                <div class="col-md-8">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-file-earmark-text me-2"></i>Log Files</span>
                            <span id="logFilesCount" class="badge bg-secondary">0 files</span>
                        </div>
                        <div class="card-body p-0 position-relative" style="min-height: 0;">
                            <div class="list-group list-group-flush relative md:absolute md:inset-0 overflow-y-auto max-h-60 md:max-h-none"
                                id="logFilesList"
                                style="scrollbar-width: none; -ms-overflow-style: none;">
                                <style>
                                    /* Chrome, Safari, OperaÏóêÏÑú Ïä§ÌÅ¨Î°§Î∞î Ïà®Í∏∞Í∏∞ */
                                    #logFilesList::-webkit-scrollbar {
                                        display: none;
                                    }
                                </style>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-header"><i class="bi bi-sliders me-2"></i>Options</div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Module Filter</label>
                                <select class="form-select" id="logModuleFilter">
                                    <option value="ALL">ALL MODULES</option>
                                </select>
                            </div>
                            <div class="mb-0">
                                <label class="form-label">Lines to show</label>
                                <select class="form-select" id="logLinesSelect">
                                    <option value="100" selected>Last 100 lines</option>
                                    <option value="500">Last 500 lines</option>
                                    <option value="1000">Last 1000 lines</option>
                                </select>
                            </div>
                            <!-- <button class="btn btn-outline-primary w-100 mt-auto" onclick="downloadCurrentLog()">
                                <i class="bi bi-download me-2"></i>Download Current Log
                            </button> -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="card d-flex flex-column" style="height: calc(100vh - 500px); min-height: 400px;">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-terminal me-2"></i><span id="currentLogFileName">trading.log</span></span>
                    <div class="d-flex gap-2">
                        <!-- Ï§ÑÎ∞îÍøà ÌÜ†Í∏Ä Î≤ÑÌäº Ï†úÍ±∞Îê® -->
                        <button class="btn btn-sm btn-outline-secondary" onclick="copyLogContent()">
                            <i class="bi bi-clipboard"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body p-0 d-flex flex-column" style="flex: 1; overflow: hidden;">
                    <pre id="logContent"
                        style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; margin: 0; flex: 1; overflow-y: auto; font-family: 'SF Mono', Monaco, 'Courier New', monospace; font-size: 0.85rem; white-space: pre; scrollbar-width: none; -ms-overflow-style: none;">Loading logs...</pre>
                </div>
            </div>
        </div>

        <!-- VIEW: YouTube Summary -->
        <div id="youtube-view" class="view-section">
            <div class="youtube-header-wrapper mb-4">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                    <div>
                        <button class="btn btn-outline-secondary d-none d-md-inline-block" onclick="showDashboard()">
                            <i class="bi bi-arrow-left"></i>
                        </button>
                        <span class="ms-md-3">
                            <h4 class="mb-1 fw-bold d-inline">YouTube Summary</h4>
                            <p class="text-muted mb-0 small d-inline ms-2">AI-powered video analysis</p>
                        </span>
                    </div>
                    <div class="d-flex gap-2 youtube-action-btns">
                        <button class="btn btn-outline-secondary" onclick="openChannelSettingsModal()">
                            <i class="bi bi-gear me-2"></i><span class="btn-text">Settings</span>
                        </button>
                        <button class="btn btn-outline-primary" onclick="loadYoutubeData()">
                            <i class="bi bi-arrow-clockwise me-2"></i><span class="btn-text">Refresh</span>
                        </button>
                        <button class="btn btn-primary" onclick="analyzeAllNewVideos()">
                            <i class="bi bi-play-fill me-2"></i><span class="btn-text">Analyze</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="row" style="height: calc(100vh - 220px); min-height: 500px;">
                <!-- Left Column: Video Lists -->
                <div class="col-md-4 d-flex flex-column" style="height: 100%;">
                    <!-- Channels -->
                    <div class="card mb-3" style="max-height: 180px;">
                        <div class="card-header d-flex justify-content-between align-items-center py-2">
                            <div class="d-flex align-items-center gap-2">
                                <span><i class="bi bi-broadcast me-2"></i>Sources</span>
                                <button class="btn btn-sm btn-outline-primary" onclick="filterBySource('')" id="allSourcesBtn" style="font-size: 0.7rem; padding: 0.1rem 0.4rem;">
                                    All
                                </button>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" onclick="openAddChannelModal()">
                                <i class="bi bi-plus-lg"></i>
                            </button>
                        </div>
                        <div class="card-body p-0" style="overflow-y: auto;">
                            <div class="list-group list-group-flush" id="youtubeChannelsList">
                                <!-- Loaded via JS -->
                            </div>
                        </div>
                    </div>



                    <!-- Summaries List -->
                    <div class="card" id="youtubeSummariesCard">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-file-text me-2"></i>Summaries</span>
                            <span id="summariesCount" class="badge bg-secondary">0 summaries</span>
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush" id="youtubeSummariesList">
                                <!-- Loaded via JS -->
                            </div>
                        </div>
                    </div>
                    <!-- Latest Videos -->
                    <div class="card mb-3" id="youtubeVideosCard">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-collection-play me-2"></i>Latest Videos</span>
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush" id="youtubeVideosList">
                                <!-- Loaded via JS -->
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Right Column: Summary Detail -->
                <div class="col-md-8 d-flex flex-column" style="height: 100%;">
                    <div class="card h-100">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h5 class="mb-1" id="summaryTitle">YouTube Summary</h5>
                                    <div id="summaryMeta"></div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0" style="overflow-y: auto;" id="summaryContent">
                            <div class="text-center py-5 text-muted">
                                <i class="bi bi-youtube fs-1"></i>
                                <p class="mt-3 mb-0">ÏôºÏ™Ω Î™©Î°ùÏóêÏÑú ÏòÅÏÉÅÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò<br>ÏÉà ÏòÅÏÉÅÏùÑ Î∂ÑÏÑùÌï¥Ï£ºÏÑ∏Ïöî</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Create Strategy -->
    <div class="modal fade" id="createModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header modal-header-primary">
                    <h5 class="modal-title"><i class="bi bi-plus-circle me-2"></i>Create New Strategy</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Strategy Name</label>
                                <input type="text" class="form-control" id="newStrategyName"
                                    placeholder="Enter strategy name" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Account</label>
                                <select class="form-select" id="accountSelect" required></select>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Strategy Type</label>
                            <select class="form-select" id="newStrategyType" onchange="toggleCreateFields()">
                                <option value="VR">üîÑ VR (Value Rebalancing)</option>
                                <option value="InfBuy">üìà InfBuy (Infinite Buy)</option>
                            </select>
                        </div>

                        <hr class="my-4">

                        <!-- VR Fields -->
                        <div id="createVrFields">
                            <h6 class="text-primary mb-3"><i class="bi bi-sliders me-2"></i>VR Configuration</h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Ticker</label>
                                    <input type="text" class="form-control" id="vr_ticker" value="TQQQ">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">G Factor</label>
                                    <input type="number" class="form-control" id="vr_g" value="13" step="0.1">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Initial Investment ($)</label>
                                    <input type="number" class="form-control" id="vr_initial_investment" value="10000">
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label">Bi-weekly Investment ($)</label>
                                    <input type="number" class="form-control" id="vr_periodic_investment" value="400">
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label">Upper Band(%)</label>
                                    <input type="number" class="form-control" id="vr_u_band" value="15" step="0.1">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Lower Band(%)</label>
                                    <input type="number" class="form-control" id="vr_l_band" value="15" step="0.1">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Daily Buy Limit(%/pool)</label>
                                    <input type="number" class="form-control" id="vr_buy_limit" value="2" step="0.01">
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label">Daily Sell Limit(%/Qty)</label>
                                    <input type="number" class="form-control" id="vr_sell_limit" value="2" step="0.01">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Advanced Option</label>
                                    <select class="form-select" id="vr_advanced_option">
                                        <option value="N" selected>N</option>
                                        <option value="Y">Y</option>
                                    </select>
                                </div>

                            </div>
                        </div>

                        <!-- InfBuy Fields -->
                        <div id="createInfBuyFields" style="display:none;">
                            <h6 class="text-primary mb-3"><i class="bi bi-sliders me-2"></i>InfBuy Configuration</h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Ticker</label>
                                    <input type="text" class="form-control" id="inf_ticker" placeholder="SOXL">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Initial Investment ($)</label>
                                    <input type="number" class="form-control" id="inf_investment" value="10000">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Division</label>
                                    <input type="number" class="form-control" id="inf_division" value="20">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Sell Gain (%)</label>
                                    <input type="number" class="form-control" id="inf_sell_gain" value="20" step="1"
                                        min="0" max="100">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Reinvestment Rate (%)</label>
                                    <input type="number" class="form-control" id="inf_reinvestment_rate" value="50"
                                        step="1" min="0" max="100">
                                    <small class="text-muted">sell profit to reinvest</small>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitCreateStrategy()">
                        <i class="bi bi-check-lg me-2"></i>Create Strategy
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Snapshot Details -->
    <div class="modal fade" id="snapshotModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-camera me-2"></i>Snapshot Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0"><i class="bi bi-database me-2"></i>State Data</h6>
                            <div>
                                <button class="btn btn-sm btn-outline-primary" id="editSnapshotBtn"
                                    onclick="enableSnapshotEdit()">
                                    <i class="bi bi-pencil me-1"></i>Edit
                                </button>
                                <button class="btn btn-sm btn-success" id="saveSnapshotBtn" onclick="saveSnapshotEdit()"
                                    style="display:none;">
                                    <i class="bi bi-check-lg me-1"></i>Save
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" id="cancelSnapshotBtn"
                                    onclick="cancelSnapshotEdit()" style="display:none;">
                                    Cancel
                                </button>
                                <button class="btn btn-sm btn-outline-danger ms-2" id="deleteSnapshotBtn"
                                    onclick="deleteSnapshot()">
                                    <i class="bi bi-trash me-1"></i>Delete
                                </button>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-4 d-flex align-items-end gap-2">
                                <label class="form-label status-label mb-0">Status</label>
                                <select class="form-select form-select-sm status-dropdown" id="snapshotDetailStatus"
                                    disabled style="width:auto; font-size:0.92em; min-width:110px; margin-left:6px;">
                                    <option value="MANUAL">MANUAL</option>
                                    <option value="INIT">INIT</option>
                                    <option value="PENDING">PENDING</option>
                                    <option value="IN_PROGRESS">IN PROGRESS</option>
                                    <option value="COMPLETED">COMPLETED</option>
                                    <option value="FAILED">FAILED</option>
                                </select>
                            </div>
                        </div>
                        <pre id="snapshotStateData">Loading...</pre>
                        <textarea id="snapshotStateEditor" class="form-control" rows="10"
                            style="display:none; font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem;"></textarea>
                    </div>
                    <div>
                        <h6 class="mb-3"><i class="bi bi-list-ul me-2"></i>Orders</h6>
                        <div class="table-responsive">
                            <table class="table table-sm small" style="font-size:0.85em; text-align:center;">
                                <thead>
                                    <tr>
                                        <th style="width:90px;">Time</th>
                                        <th style="width:60px;">Type</th>
                                        <th style="width:80px;">Ticker</th>
                                        <th style="width:90px;">Price</th>
                                        <th style="width:90px;">Qty</th>
                                        <th style="width:90px;">Status</th>
                                        <th style="width:80px;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="snapshotOrdersBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Create Snapshot -->
    <div class="modal fade" id="createSnapshotModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header modal-header-primary">
                    <h5 class="modal-title"><i class="bi bi-camera-plus me-2"></i>Create Snapshot</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="snapshotStatus">
                                <option value="MANUAL" selected>MANUAL</option>
                                <option value="INIT">INIT</option>
                                <option value="PENDING">PENDING</option>
                                <option value="IN_PROGRESS">IN PROGRESS</option>
                                <option value="COMPLETED">COMPLETED</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Cycle (optional)</label>
                            <input type="number" class="form-control" id="snapshotCycle" placeholder="auto">
                        </div>
                    </div>
                    <div class="mt-3">
                        <label class="form-label">Progress JSON</label>
                        <textarea id="snapshotProgress" class="form-control" rows="10" placeholder="{ }"
                            style="font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem;"></textarea>
                        <small class="text-muted">Leave empty for an empty object.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitCreateSnapshot()">
                        <i class="bi bi-check-lg me-2"></i>Create Snapshot
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Add YouTube Channel -->
    <div class="modal fade" id="addChannelModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header modal-header-primary">
                    <h5 class="modal-title"><i class="bi bi-plus-circle me-2"></i>Add YouTube Channel</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Source Type <span class="text-danger">*</span></label>
                        <select class="form-select" id="newSourceType" onchange="toggleSourceFields()">
                            <option value="channel">Channel</option>
                            <option value="playlist">Playlist</option>
                        </select>
                    </div>
                    <div class="mb-3" id="newChannelIdGroup">
                        <label class="form-label">Channel ID <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="newChannelId" placeholder="UCxxxxxxxxxx">
                        <small class="text-muted">YouTube Ï±ÑÎÑê URLÏóêÏÑú channel_id Í∞íÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî</small>
                    </div>
                    <div class="mb-3" id="newPlaylistIdGroup" style="display: none;">
                        <label class="form-label">Playlist ID <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="newPlaylistId" placeholder="PLxxxxxxxxxx">
                        <small class="text-muted">YouTube ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ URLÏóêÏÑú playlist_id Í∞íÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Name (optional)</label>
                        <input type="text" class="form-control" id="newChannelName" placeholder="ÏûêÎèôÏúºÎ°ú Í∞ÄÏ†∏ÏòµÎãàÎã§">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Custom Prompt (optional)</label>
                        <textarea class="form-control" id="newChannelPrompt" rows="5" 
                            placeholder="ÎπÑÏõåÎëêÎ©¥ Í∏∞Î≥∏ ÌîÑÎ°¨ÌîÑÌä∏Î•º ÏÇ¨Ïö©Ìï©ÎãàÎã§. Î≥ÄÏàò: {title}, {channel_name}, {video_url}"
                            style="font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem;"></textarea>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="newChannelEnabled" checked>
                        <label class="form-check-label" for="newChannelEnabled">Enable monitoring</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitAddChannel()">
                        <i class="bi bi-check-lg me-2"></i>Add Channel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Edit YouTube Channel -->
    <div class="modal fade" id="editChannelModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-pencil me-2"></i>Edit Channel</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editChannelId">
                    <div class="mb-3">
                        <label class="form-label">Channel Name</label>
                        <input type="text" class="form-control" id="editChannelName">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Custom Prompt</label>
                        <textarea class="form-control" id="editChannelPrompt" rows="8"
                            placeholder="ÎπÑÏõåÎëêÎ©¥ Í∏∞Î≥∏ ÌîÑÎ°¨ÌîÑÌä∏Î•º ÏÇ¨Ïö©Ìï©ÎãàÎã§. Î≥ÄÏàò: {title}, {channel_name}, {video_url}"
                            style="font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem;"></textarea>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="editChannelEnabled">
                        <label class="form-check-label" for="editChannelEnabled">Enable monitoring</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger me-auto" onclick="deleteChannelFromModal()">
                        <i class="bi bi-trash me-1"></i>Delete
                    </button>
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitEditChannel()">
                        <i class="bi bi-check-lg me-2"></i>Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Channel Settings (Default Prompt) -->
    <div class="modal fade" id="channelSettingsModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-gear me-2"></i>YouTube Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Default Prompt Template</label>
                        <p class="text-muted small mb-2">Ï±ÑÎÑêÏóê Ïª§Ïä§ÌÖÄ ÌîÑÎ°¨ÌîÑÌä∏Í∞Ä ÏóÜÏùÑ Îïå ÏÇ¨Ïö©Îê©ÎãàÎã§. Î≥ÄÏàò: {title}, {channel_name}, {video_url}</p>
                        <textarea class="form-control" id="defaultPromptText" rows="15"
                            style="font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem;"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveDefaultPrompt()">
                        <i class="bi bi-check-lg me-2"></i>Save Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Markdown rendering libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/strategy.js"></script>
    <script src="/static/js/order.js"></script>
    <script src="/static/js/logs.js"></script>
    <script src="/static/js/youtube.js"></script>
    <script src="/static/js/app.js"></script>
    <script>
        // Fear & Greed Index Ìï®Ïàò
        function getStatusLabel(value) {
            if (value <= 25) return 'Extreme Fear';
            if (value <= 45) return 'Fear';
            if (value <= 55) return 'Neutral';
            if (value <= 75) return 'Greed';
            return 'Extreme Greed';
        }

        function getBadgeColor(value) {
            if (value <= 25) return '#e85d75'; // Sophisticated red for Extreme Fear
            if (value <= 45) return '#ff8c42'; // Vibrant orange for Fear
            if (value <= 55) return '#8b95a5'; // Cool gray for Neutral
            if (value <= 75) return '#4ea8de'; // Bright blue for Greed
            return '#5ebd8f'; // Fresh green for Extreme Greed
        }

        async function updateFearGreedIndex() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const url = `https://production.dataviz.cnn.io/index/fearandgreed/graphdata/${today}`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                console.log('Fear & Greed Data:', data);
                
                if (data && data.fear_and_greed && data.fear_and_greed.score !== undefined) {
                    const value = parseInt(data.fear_and_greed.score);
                    let rating = data.fear_and_greed.rating || getStatusLabel(value);
                    // Capitalize first letter
                    rating = rating.charAt(0).toUpperCase() + rating.slice(1).toLowerCase();
                    const bgColor = getBadgeColor(value);
                    
                    console.log(`Score: ${value}, Rating: ${rating}, Color: ${bgColor}`);
                    
                    const badge = document.getElementById('fearGreedBadge');
                    badge.className = 'fear-greed-indicator';
                    badge.style.cssText = `height: 32px; padding: 0 14px; display: inline-flex; align-items: center; justify-content: center; border-radius: 6px; font-weight: 600; font-size: 0.85rem; line-height: 32px; box-shadow: 0 2px 6px rgba(0,0,0,0.12); transition: all 0.3s ease; background-color: ${bgColor}; color: #ffffff;`;
                    badge.innerHTML = `<i class="bi bi-graph-up me-2"></i><span style="opacity: 0.95;">${rating}</span><span style="margin: 0 6px; opacity: 0.6;">‚Ä¢</span><span style="font-weight: 700;">${value}</span>`;
                } else {
                    throw new Error('Invalid data format');
                }
            } catch (error) {
                console.error('Failed to fetch Fear & Greed Index:', error);
                const badge = document.getElementById('fearGreedBadge');
                badge.className = 'fear-greed-indicator';
                badge.style.cssText = 'height: 32px; padding: 0 14px; display: inline-flex; align-items: center; justify-content: center; border-radius: 6px; font-weight: 600; font-size: 0.85rem; line-height: 32px; box-shadow: 0 2px 6px rgba(0,0,0,0.12); background-color: #6c757d; color: #ffffff; opacity: 0.7;';
                badge.innerHTML = '<i class="bi bi-exclamation-triangle me-2"></i>Unavailable';
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ïã§Ìñâ
        document.addEventListener('DOMContentLoaded', updateFearGreedIndex);
        // 1Î∂ÑÎßàÎã§ ÏóÖÎç∞Ïù¥Ìä∏
        setInterval(updateFearGreedIndex, 60 * 1000);
        
        // Î™®Î∞îÏùº ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò active ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function updateMobileNavActive(viewName) {
            document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.view === viewName) {
                    btn.classList.add('active');
                }
            });
        }
    </script>
    
    <!-- Î™®Î∞îÏùº ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
    <nav class="mobile-nav">
        <div class="mobile-nav-inner">
            <button class="mobile-nav-btn active" data-view="dashboard" onclick="showDashboard(); updateMobileNavActive('dashboard');">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </button>
            <button class="mobile-nav-btn" data-view="youtube" onclick="showYoutubeSummary(); updateMobileNavActive('youtube');">
                <i class="fab fa-youtube"></i>
                <span>YouTube</span>
            </button>
            <button class="mobile-nav-btn" data-view="logs" onclick="showLogs(); updateMobileNavActive('logs');">
                <i class="fas fa-file-alt"></i>
                <span>Logs</span>
            </button>
        </div>
    </nav>
</body>

</html>